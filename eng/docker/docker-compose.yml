name: immosearch

services:
  api:
    image: immosearch.api
    container_name: immosearch-api
    build:
      context: ../..
      dockerfile: eng/docker/Dockerfile.api
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:8080
      ConnectionStrings__DefaultConnection: Data Source=/data/immo.db
      Admin__Token: ${ADMIN_TOKEN:-}
      Notifications__WebPush__Enabled: ${NOTIFICATIONS_WEBPUSH_ENABLED:-false}
      Notifications__WebPush__PublicKey: ${NOTIFICATIONS_WEBPUSH_PUBLICKEY:-}
      Notifications__WebPush__PrivateKey: ${NOTIFICATIONS_WEBPUSH_PRIVATEKEY:-}
      Notifications__WebPush__Subject: ${NOTIFICATIONS_WEBPUSH_SUBJECT:-}
      Cors__AllowedOrigins: ${CORS_ALLOWED_ORIGINS:-}
    volumes:
      - ${DATA_DIR:-../../assets/docker/data}:/data
    ports:
      - "8080:8080"
  web:
    image: immosearch.web
    container_name: immosearch-web
    build:
      context: ../..
      dockerfile: eng/docker/Dockerfile.web
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:8081
      ApiBaseUrl: ${API_BASE_URL:-http://api:8080}
    depends_on:
      - api
    ports:
      - "8081:8081"
